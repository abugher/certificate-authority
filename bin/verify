#!/bin/bash
# verify - Verify an SSL certificate, specified by a short hostname.
# verify <shorthostname>

# Find self.
OLDPWD="${PWD}"
cd "${0%/*}/.."
certificate_authority="${PWD}"
cd "${OLDPWD}"

#Load libraries.
libs=(
  'verify_validity'
  'verify_cert_matches_key'
)
if ! . "${certificate_authority}/lib/common.sh"; then
  echo "Failed to load common dependencies." >&2
  exit 1
fi

if test "${#}" -ne 1; then
  fail $ERR_USAGE "Specify one short hostname."
fi


# sanity check
for prereq in "${verify_prereqs}"; do
  if ! test -e "${prereq}"; then
    fail $ERR_PREREQ "Required file does not exist:  ${prereq}"
  fi
done

# verify
verify_validity
verify_cert_matches_key
